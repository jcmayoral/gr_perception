<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GrassRobotics Common: Similarity Learning Using Triplet Loss</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GrassRobotics Common
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Similarity Learning Using Triplet Loss </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this reference, we use triplet loss to learn embeddings which can be used to differentiate images. This learning technique was popularized by <a href="https://arxiv.org/abs/1503.03832">FaceNet: A Unified Embedding for Face Recognition and Clustering</a> and has been quite effective in learning embeddings to differentiate between faces.</p>
<p>This reference can be directly applied to the following use cases:</p>
<ul>
<li>You have an unknown number of classes and would like to train a model to learn how to differentiate between them.</li>
<li>You want to train a model to learn a distance-based metric between samples. For example, learning a distance-based similarity measure between faces.</li>
</ul>
<h3>Training</h3>
<p>By default, the training script trains ResNet50 on the FashionMNIST Dataset to learn image embeddings which can be used to differentiate between images by measuring the euclidean distance between embeddings. This can be changed as per your requirements.</p>
<p>Image embeddings of the same class should be 'close' to each other, while image embeddings between different classes should be 'far' away.</p>
<p>To run the training script:</p>
<div class="fragment"><div class="line">python train.py -h    # Lists all optional arguments</div><div class="line">python train.py             # Runs training script with default args</div></div><!-- fragment --><p>Running the training script as is should yield 97% accuracy on the FMNIST test set within 10 epochs.</p>
<h3>Loss</h3>
<p><code>TripletMarginLoss</code> is a loss function which takes in a triplet of samples. A valid triplet has an:</p>
<ol type="1">
<li>Anchor: a sample from the dataset</li>
<li>Positive: another sample with the same label/group as the anchor (Generally, positive != anchor)</li>
<li>Negative: a sample with a different label/group from the anchor</li>
</ol>
<p><code>TripletMarginLoss</code> (refer to <code><a class="el" href="loss_8py_source.html">loss.py</a></code>) does the following:</p>
<div class="fragment"><div class="line">loss = max(dist(anchor, positive) - dist(anchor, negative) + margin, 0)</div></div><!-- fragment --><p> Where <code>dist</code> is a distance function. Minimizing this function effectively leads to minimizing <code>dist(anchor, positive)</code> and maximizing <code>dist(anchor, negative)</code>.</p>
<p>The FaceNet paper describe this loss in more detail.</p>
<h3>Sampler</h3>
<p>In order to generate valid triplets from a batch of samples, we need to make sure that each batch has multiple samples with the same label. We do this using <code>PKSampler</code> (refer to <code><a class="el" href="sampler_8py_source.html">sampler.py</a></code>), which ensures that each batch of size <code>p * k</code> will have samples from exactly <code>p</code> classes and <code>k</code> samples per class.</p>
<h3>Triplet Mining</h3>
<p><code>TripletMarginLoss</code> currently supports the following mining techniques:</p>
<ul>
<li><code>batch_all</code>: Generates all possible triplets from a batch and excludes the triplets which are 'easy' (which have <code>loss = 0</code>) before passing it through the loss function.</li>
<li><code>batch_hard</code>: For every anchor, <code>batch_hard</code> creates a triplet with the 'hardest' positive (farthest positive) and negative (closest negative).</li>
</ul>
<p>These mining strategies usually speed up training.</p>
<p>This <a href="https://omoindrot.github.io/triplet-loss">webpage</a> describes the sampling and mining strategies in more detail. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
